<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gratitude 2025 | Centre for Social Action üéÑ</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

    <style>
         :root {
            --ease: cubic-bezier(.22, 1, .36, 1);
            --candle: .9;
        }
        /* RESET */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }
        /* BODY */
        
        body {
            min-height: 100vh;
            background: radial-gradient(circle at center, rgba(255, 200, 120, .18), transparent 55%), linear-gradient(180deg, #050b1f, #0b2540);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            font-family: "Playfair Display", serif;
        }
        /* CANDLE */
        
        body::before {
            content: "";
            position: fixed;
            inset: -30%;
            background: radial-gradient(circle, rgba(255, 200, 130, .35), rgba(255, 170, 90, .22), rgba(255, 120, 40, .12), transparent 65%);
            opacity: var(--candle);
            animation: flicker 12s infinite ease-in-out;
            pointer-events: none;
        }
        
        @keyframes flicker {
            50% {
                transform: scale(1.015)
            }
        }
        /* CARD */
        
        .card {
            width: 100%;
            max-width: 520px;
            padding: 38px 28px;
            border-radius: 28px;
            background: linear-gradient(180deg, rgba(255, 255, 255, .26), rgba(255, 255, 255, .06));
            backdrop-filter: blur(32px) saturate(160%);
            border: 1px solid rgba(255, 255, 255, .18);
            box-shadow: 0 40px 120px rgba(0, 0, 0, .6);
            text-align: center;
        }
        
        .preview,
        .send-stage,
        .success {
            display: none
        }
        
        .flow {
            font-size: .7rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            opacity: .75;
            margin-bottom: 14px
        }
        
        .subtitle {
            font-size: .9rem;
            line-height: 1.6;
            opacity: .9;
            margin-bottom: 24px
        }
        /* INPUTS */
        
        input,
        textarea {
            width: 100%;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, .3);
            padding: 14px 16px;
            background: rgba(255, 255, 255, .15);
            color: #fff;
            margin-bottom: 12px;
        }
        /* BUTTON */
        
        button {
            width: 100%;
            padding: 14px;
            border-radius: 24px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            background: #fff;
            color: #1a1a1a;
        }
        /* LETTER */
        
        .letter {
            background: linear-gradient(180deg, #f7ead1, #e4d1a3);
            color: #4b2e1e;
            padding: 34px 28px;
            border-radius: 16px;
            font-family: "Dancing Script", cursive;
            font-size: 1.35rem;
            line-height: 1.65;
            box-shadow: 0 20px 50px rgba(0, 0, 0, .4), inset 0 1px 0 rgba(255, 255, 255, .6);
            position: relative;
        }
        /* Paper thickness */
        
        .letter::before {
            content: "";
            position: absolute;
            inset: 6px;
            background: rgba(0, 0, 0, .03);
            border-radius: 14px;
            z-index: -1;
        }
        /* HANDWRITING */
        
        .handwriting {
            white-space: pre-wrap;
            border-right: 2px solid rgba(75, 46, 30, .4);
            animation: caret 1.4s steps(1) infinite;
        }
        
        @keyframes caret {
            50% {
                border-color: transparent
            }
        }
        
        .live-letter {
            transition: transform 7s var(--ease), opacity 3s var(--ease);
        }
        /* ENVELOPE */
        
        .envelope-scene {
            position: relative;
            height: 360px;
            margin-top: 20px;
        }
        
        .envelope-message {
            position: absolute;
            top: 0;
            width: 100%;
            text-align: center;
            font-size: .85rem;
            opacity: 0;
            transition: opacity 3s var(--ease);
            color: rgba(255, 255, 255, .75);
        }
        
        .envelope-shell {
            position: absolute;
            bottom: 28px;
            left: 50%;
            transform: translateX(-50%);
            width: 260px;
            height: 170px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 12px 30px rgba(0, 0, 0, .4);
        }
        
        .envelope-body {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, #ead8b8, #d6c2a0);
        }
        
        .envelope-flap {
            position: absolute;
            top: 0;
            width: 100%;
            height: 55%;
            background: linear-gradient(180deg, #d2b48c, #c3a77b);
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top;
            transition: transform 5s var(--ease);
        }
        /* SEAL */
        
        .seal {
            position: absolute;
            width: 56px;
            height: 56px;
            background: #8b1e1e;
            border-radius: 50%;
            left: 50%;
            bottom: 46px;
            transform: translateX(-50%) scale(.15);
            opacity: 0;
            box-shadow: inset 0 -6px 10px rgba(0, 0, 0, .4), inset 0 4px 6px rgba(255, 255, 255, .25);
            transition: all 5s var(--ease);
        }
        
        .seal::after {
            content: "CSA";
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, .5);
        }
        /* Quote above seal */
        
        .seal-quote {
            position: absolute;
            bottom: 108px;
            left: 50%;
            transform: translateX(-50%);
            font-size: .8rem;
            font-family: "Playfair Display", serif;
            color: rgba(255, 255, 255, .75);
            opacity: 0;
            transition: opacity 3s var(--ease);
        }
        /* SUCCESS */
        
        .success {
            animation: fade 2s var(--ease)
        }
        
        @keyframes fade {
            from {
                opacity: 0;
                transform: translateY(16px)
            }
            to {
                opacity: 1
            }
        }
        /* ================= INTRO OVERLAY ================= */
        
        #intro {
            position: fixed;
            inset: 0;
            z-index: 999;
            background: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            transition: opacity 2.5s var(--ease);
        }
        /* Snow */
        
        .intro-snow span {
            position: absolute;
            top: -10px;
            width: 5px;
            height: 5px;
            background: white;
            border-radius: 50%;
            opacity: .6;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(110vh)
            }
        }
        /* Santa helpers (minimal silhouettes) */
        
        .intro-elf {
            position: absolute;
            bottom: 42px;
            width: 18px;
            height: 28px;
            background: linear-gradient(#e11d48, #7f1d1d);
            border-radius: 4px;
            opacity: .85;
            animation: run 9s linear infinite;
        }
        
        .intro-elf::after {
            content: "‚úâÔ∏è";
            position: absolute;
            top: -12px;
            left: -2px;
            font-size: 12px;
        }
        
        @keyframes run {
            from {
                left: -10%
            }
            to {
                left: 110%
            }
        }
        /* Envelope entrance */
        
        .intro-envelope {
            width: 200px;
            height: 120px;
            background: linear-gradient(180deg, #ead8b8, #d6c2a0);
            border-radius: 14px;
            position: relative;
            transform: scale(.5) translateY(60px);
            opacity: 0;
            animation: envelopeIn 4s var(--ease) forwards;
        }
        
        @keyframes envelopeIn {
            0% {
                opacity: 0;
                transform: scale(.5) translateY(80px)
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0)
            }
        }
        
        .intro-envelope::after {
            content: "";
            position: absolute;
            top: 0;
            width: 100%;
            height: 55%;
            background: linear-gradient(180deg, #d2b48c, #c3a77b);
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top;
            animation: peek 2.5s var(--ease) forwards;
            animation-delay: 3.2s;
        }
        
        @keyframes peek {
            to {
                transform: rotateX(35deg)
            }
        }
        /* Intro text */
        
        .intro-text {
            margin-top: 18px;
            font-size: .85rem;
            opacity: .8;
            animation: fadeIn 3s ease forwards;
            animation-delay: 2.5s;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1
            }
        }
        /* Brighter & clearer placeholder text */
        
        input::placeholder,
        textarea::placeholder {
            color: rgba(255, 255, 255, 0.85);
            opacity: 1;
            font-weight: 500;
        }
        /* Safari & older browser support */
        
        input::-webkit-input-placeholder,
        textarea::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.85);
        }
        
        input:-ms-input-placeholder,
        textarea:-ms-input-placeholder {
            color: rgba(255, 255, 255, 0.85);
        }
        /* ===== CINEMATIC LIGHT BREATH ===== */
        
        body::after {
            content: "";
            position: fixed;
            inset: -20%;
            background: radial-gradient(circle at center, rgba(255, 200, 120, .12), rgba(0, 0, 0, .35) 70%);
            animation: lightBreath 18s ease-in-out infinite;
            pointer-events: none;
            mix-blend-mode: overlay;
        }
        
        @keyframes lightBreath {
            0%,
            100% {
                opacity: .45;
                transform: scale(1)
            }
            50% {
                opacity: .7;
                transform: scale(1.05)
            }
        }
        /* ===== FILM GRAIN ===== */
        
        .film-grain {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 998;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.05'/%3E%3C/svg%3E");
            animation: grainMove .8s steps(2) infinite;
        }
        
        @keyframes grainMove {
            to {
                transform: translate3d(-10%, 10%, 0)
            }
        }
        /* ===== INTRO TITLE CARD ===== */
        
        .intro-title {
            margin-top: 18px;
            font-size: 1.2rem;
            letter-spacing: .25em;
            text-transform: uppercase;
            opacity: 0;
            animation: introTitle 4s ease forwards;
            animation-delay: 2.8s;
        }
        
        .intro-sub {
            margin-top: 10px;
            font-size: .8rem;
            letter-spacing: .18em;
            opacity: 0;
            animation: introTitle 4s ease forwards;
            animation-delay: 4.2s;
        }
        
        @keyframes introTitle {
            to {
                opacity: .85
            }
        }
        /* ===== LETTER SPOTLIGHT ===== */
        
        .live-letter {
            position: relative;
        }
        
        .live-letter::after {
            content: "";
            position: absolute;
            inset: -20%;
            background: radial-gradient(circle at center, rgba(255, 200, 120, .18), transparent 65%);
            opacity: 0;
            transition: opacity 4s var(--ease);
            pointer-events: none;
        }
        
        .send-stage .live-letter::after {
            opacity: 1;
        }
        /* ===== CINEMATIC CAMERA PUSH-IN ===== */
        
        .send-stage {
            perspective: 1200px;
        }
        
        .send-stage .letter {
            transform-origin: center center;
            animation: cameraPush 18s cubic-bezier(.22, 1, .36, 1) forwards;
        }
        
        @keyframes cameraPush {
            0% {
                transform: scale(1) translateY(0);
            }
            100% {
                transform: scale(1.035) translateY(-6px);
            }
        }
        /* Slight depth softening for realism */
        
        .send-stage .letter {
            box-shadow: 0 30px 80px rgba(0, 0, 0, .45), inset 0 1px 0 rgba(255, 255, 255, .6);
        }
        /* ================= MOBILE REFINEMENTS ================= */
        
        @media (max-width: 600px) {
            body {
                padding: env(safe-area-inset-top) 14px env(safe-area-inset-bottom);
                align-items: flex-start;
            }
            .card {
                max-width: 100%;
                padding: 28px 20px;
                border-radius: 22px;
                margin-top: 16px;
            }
            h1 {
                font-size: 1.45rem;
            }
            .subtitle {
                font-size: .9rem;
                margin-bottom: 18px;
            }
            input,
            textarea {
                font-size: 1rem;
                padding: 14px 16px;
                border-radius: 18px;
            }
            textarea {
                min-height: 140px;
            }
            button {
                padding: 15px;
                font-size: 1rem;
                border-radius: 22px;
            }
            /* ===== LETTER ===== */
            .letter {
                font-size: 1.15rem;
                line-height: 1.65;
                padding: 26px 20px;
            }
            .signature {
                margin-top: 18px;
                font-size: .9rem;
            }
            /* ===== ENVELOPE SCENE ===== */
            .envelope-scene {
                height: 300px;
                margin-top: 12px;
            }
            .envelope-shell {
                width: 220px;
                height: 150px;
            }
            .seal {
                width: 48px;
                height: 48px;
                bottom: 40px;
            }
            .seal::after {
                font-size: .7rem;
            }
            .seal-quote {
                font-size: .75rem;
                bottom: 96px;
            }
            .envelope-message {
                font-size: .75rem;
            }
            /* ===== INTRO ===== */
            .intro-title {
                font-size: 1rem;
                letter-spacing: .18em;
            }
            .intro-sub {
                font-size: .7rem;
                letter-spacing: .15em;
            }
            .intro-envelope {
                width: 160px;
                height: 96px;
            }
            /* ===== REDUCE MOTION (BATTERY + COMFORT) ===== */
            @media (prefers-reduced-motion: reduce) {
                * {
                    animation-duration: .01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: .01ms !important;
                }
            }
        }
        
        button {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        /* ================= GRATITUDE CINEMATIC INTRO ================= */
        
        #gratitudeIntro {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: radial-gradient(circle at center, rgba(255, 200, 120, .18), transparent 60%), linear-gradient(180deg, #020617, #050b1f);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: opacity 2.8s cubic-bezier(.22, 1, .36, 1);
        }
        /* Warm breathing light */
        
        .intro-glow {
            position: absolute;
            inset: -30%;
            background: radial-gradient(circle, rgba(255, 200, 120, .22), transparent 65%);
            animation: glowBreath 14s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes glowBreath {
            0%,
            100% {
                opacity: .35;
                transform: scale(1);
            }
            50% {
                opacity: .6;
                transform: scale(1.06);
            }
        }
        /* Snow */
        
        .intro-snow span {
            position: absolute;
            top: -10px;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            opacity: .6;
            animation: snowFall linear infinite;
        }
        
        @keyframes snowFall {
            to {
                transform: translateY(110vh);
            }
        }
        /* Center content */
        
        .intro-center {
            position: relative;
            text-align: center;
            color: #fff;
            animation: introFadeUp 3s cubic-bezier(.22, 1, .36, 1);
        }
        
        @keyframes introFadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: none;
            }
        }
        /* Gratitude word */
        
        .intro-word {
            font-family: "Playfair Display", serif;
            font-size: clamp(2.2rem, 6vw, 3.4rem);
            letter-spacing: .08em;
            margin-bottom: 18px;
        }
        /* Manifesto */
        
        .intro-manifesto {
            font-size: .85rem;
            letter-spacing: .18em;
            opacity: .85;
            margin-bottom: 28px;
        }
        /* Enter button */
        
        .intro-enter {
            padding: 14px 34px;
            border-radius: 999px;
            background: rgba(255, 255, 255, .12);
            border: 1px solid rgba(255, 255, 255, .45);
            color: #fff;
            font-size: .85rem;
            letter-spacing: .12em;
            cursor: pointer;
            backdrop-filter: blur(12px);
            transition: all .6s cubic-bezier(.22, 1, .36, 1);
        }
        
        .intro-enter:hover {
            background: rgba(255, 255, 255, .22);
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <div class="film-grain"></div>

    <!-- ===== CINEMATIC GRATITUDE INTRO ===== -->
    <div id="gratitudeIntro">
        <div class="intro-glow"></div>
        <div class="intro-snow" id="gratitudeSnow"></div>

        <div class="intro-center">
            <div class="intro-word" id="introWord"></div>
            <div class="intro-manifesto">
                Written ‚Ä¢ Remembered ‚Ä¢ Preserved
            </div>
            <button class="intro-enter" onclick="enterGratitude()">
            Enter quietly
        </button>
        </div>
    </div>

    <!-- ===== INTRO OVERLAY ===== -->
    <div id="intro">
        <div class="intro-snow" id="introSnow"></div>

        <div class="intro-elf"></div>
        <div class="intro-elf" style="animation-delay:3s"></div>

        <div class="intro-envelope"></div>
        <div class="intro-title">Gratitude 2025</div>
        <div class="intro-sub">
            Written ‚Ä¢ Remembered ‚Ä¢ Preserved
        </div>

    </div>


    <!-- WRITE -->
    <div class="card" id="formBox">
        <div class="flow">Centre for Social Action</div>
        <h1>üéÑ Gratitude 2025</h1>
        <p class="subtitle">You don‚Äôt have to rush this.</p>
        <input id="recipient" placeholder="Who are you grateful for?" />
        <textarea id="message" placeholder="Write your gratitude here‚Ä¶"></textarea>
        <button onclick="showPreview()">Preview Letter</button>
    </div>

    <!-- PREVIEW -->
    <div class="card preview" id="previewBox">
        <div class="letter">
            <div id="pTo"></div>
            <div id="pMessage"></div>
            <div class="signature">‚Äî Centre for Social Action</div>
        </div>
        <button onclick="sendFinal()">Seal & Send</button>
    </div>

    <!-- SEND -->
    <div class="card send-stage" id="sendBox">
        <div class="letter live-letter handwriting" id="liveLetter"></div>

        <div class="envelope-scene">
            <div class="envelope-message" id="envelopeMessage">
                Take a breath. This moment matters.
            </div>

            <div class="envelope-shell">
                <div class="envelope-body"></div>
                <div class="envelope-flap" id="flap"></div>
            </div>

            <div class="seal-quote" id="sealQuote">
                With gratitude, gently sealed.
            </div>

            <div class="seal" id="seal"></div>
        </div>
    </div>

    <!-- SUCCESS -->
    <div class="card success" id="successBox">
        <h1>ü§ç It has been received</h1>
        <p class="subtitle">Thank you for taking this moment.</p>
    </div>

    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyAfg-H64wDdxB4NOpfSDVzY9z-iUxaT7gI",
            authDomain: "csa-christmas-gratitude.firebaseapp.com",
            projectId: "csa-christmas-gratitude"
        });
        const db = firebase.firestore();

        function showPreview() {
            if (!recipient.value || !message.value) return;
            formBox.style.display = "none";
            previewBox.style.display = "block";
            pTo.textContent = "To: " + recipient.value;
            pMessage.textContent = message.value;
        }

        function typeHandwriting(el, text) {
            el.innerHTML = "";
            document.documentElement.style.setProperty('--candle', '1.15');
            let i = 0;
            const t = setInterval(() => {
                el.innerHTML += text[i];
                i++;
                if (i >= text.length) {
                    clearInterval(t);
                    el.classList.remove("handwriting");
                }
            }, 140);
        }

        async function sendFinal() {
            previewBox.style.display = "none";
            sendBox.style.display = "block";

            const full = `To: ${recipient.value}\n\n${message.value}\n\n‚Äî Centre for Social Action`;
            typeHandwriting(liveLetter, full);
            // üé• Start gentle camera push-in
            liveLetter.style.animationPlayState = "running";


            const writingTime = full.length * 140;

            // Fold + insert
            setTimeout(() => {
                liveLetter.style.transform = "translateY(230px) scale(.72)";
                liveLetter.style.opacity = "0";
                envelopeMessage.style.opacity = "1";
            }, writingTime + 2200);

            // Close envelope
            setTimeout(() => {
                envelopeMessage.style.opacity = "0";
                flap.style.transform = "rotateX(180deg)";
            }, writingTime + 7200);

            // Seal + quote
            setTimeout(() => {
                seal.style.opacity = "1";
                seal.style.transform = "translateX(-50%) scale(1)";
                sealQuote.style.opacity = "1";
                document.documentElement.style.setProperty('--candle', '.85');
            }, writingTime + 11500);

            // Rest, then close
            setTimeout(() => {
                sendBox.style.display = "none";
                successBox.style.display = "block";
            }, writingTime + 16500);

            await db.collection("messages").add({
                recipient: recipient.value,
                message: message.value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            // üé¨ Ease camera back before transition
            setTimeout(() => {
                liveLetter.style.transform = "scale(1)";
            }, writingTime + 14500);

        }

        /* ===== INTRO LOGIC ===== */

        // Create snowfall
        for (let i = 0; i < 40; i++) {
            const s = document.createElement("span");
            s.style.left = Math.random() * 100 + "%";
            s.style.animationDuration = 6 + Math.random() * 6 + "s";
            document.getElementById("introSnow").appendChild(s);
        }

        // Fade out intro & reveal app
        setTimeout(() => {
            const intro = document.getElementById("intro");
            if (!intro) return;

            intro.style.opacity = "0";

            setTimeout(() => {
                intro.remove();
            }, 2500);
        }, 8000);

        /* ===== MOBILE KEYBOARD SAFETY ===== */
        const viewport = window.visualViewport;

        if (viewport) {
            viewport.addEventListener("resize", () => {
                document.body.style.paddingBottom =
                    viewport.height < window.innerHeight ?
                    "280px" :
                    "";
            });
        }

        /* ===== GRATITUDE INTRO LOGIC ===== */

        // Snow generation
        for (let i = 0; i < 50; i++) {
            const s = document.createElement("span");
            s.style.left = Math.random() * 100 + "%";
            s.style.animationDuration = 6 + Math.random() * 8 + "s";
            document.getElementById("gratitudeSnow").appendChild(s);
        }

        // Type ‚ÄúGratitude‚Äù slowly
        const word = "Gratitude";
        let wi = 0;
        const introWord = document.getElementById("introWord");

        const typeIntro = setInterval(() => {
            introWord.textContent += word[wi];
            wi++;
            if (wi >= word.length) clearInterval(typeIntro);
        }, 260);

        // Enter app
        function enterGratitude() {
            const intro = document.getElementById("gratitudeIntro");
            intro.style.opacity = "0";

            setTimeout(() => {
                intro.remove();
            }, 2800);
        }
    </script>

</body>

</html>